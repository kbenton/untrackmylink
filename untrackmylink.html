<!DOCTYPE html>
<html lang="en">
    <head>
        <title>Untrack My Link</title>
        <meta charset="UTF-8">
        <meta http-equiv="X-UA-Compatible" content="IE=edge">
        <meta name="viewport" content="width=device-width, initial-scale=1.0">
        <style>:root,::backdrop{--sans-font:-apple-system, BlinkMacSystemFont, "Avenir Next", Avenir,
            "Nimbus Sans L", Roboto, "Noto Sans", "Segoe UI", Arial, Helvetica,
            "Helvetica Neue", sans-serif;--mono-font:Consolas, Menlo, Monaco, "Andale Mono", "Ubuntu Mono", monospace;--standard-border-radius:5px;--bg:#fff;--accent-bg:#f5f7ff;--text:#212121;--text-light:#585858;--border:#898EA4;--accent:#0d47a1;--accent-hover:#1266e2;--accent-text:var(--bg);--code:#d81b60;--preformatted:#444;--marked:#ffdd33;--disabled:#efefef}@media (prefers-color-scheme:dark){:root,::backdrop{color-scheme:dark;--bg:#212121;--accent-bg:#2b2b2b;--text:#dcdcdc;--text-light:#ababab;--accent:#ffb300;--accent-hover:#ffe099;--accent-text:var(--bg);--code:#f06292;--preformatted:#ccc;--disabled:#111}img,video{opacity:.8}}*,*::before,*::after{box-sizing:border-box}textarea,select,input,progress{appearance:none;-webkit-appearance:none;-moz-appearance:none}html{font-family:var(--sans-font);scroll-behavior:smooth}body{color:var(--text);background-color:var(--bg);font-size:1.15rem;line-height:1.5;display:grid;grid-template-columns:1fr min(45rem, 90%) 1fr;margin:0}body>*{grid-column:2}body>header{background-color:var(--accent-bg);border-bottom:1px solid var(--border);text-align:center;padding:0 .5rem 2rem .5rem;grid-column:1 / -1}body>header>*:only-child{margin-block-start:2rem}body>header h1{max-width:1200px;margin:1rem auto}body>header p{max-width:40rem;margin:1rem auto}main{padding-top:1.5rem}body>footer{margin-top:4rem;padding:2rem 1rem 1.5rem 1rem;color:var(--text-light);font-size:.9rem;text-align:center;border-top:1px solid var(--border)}h1{font-size:3rem}h2{font-size:2.6rem;margin-top:3rem}h3{font-size:2rem;margin-top:3rem}h4{font-size:1.44rem}h5{font-size:1.15rem}h6{font-size:.96rem}p{margin:1.5rem 0}p,h1,h2,h3,h4,h5,h6{overflow-wrap:break-word}h1,h2,h3{line-height:1.1}@media only screen and (max-width:720px){h1{font-size:2.5rem}h2{font-size:2.1rem}h3{font-size:1.75rem}h4{font-size:1.25rem}}a,a:visited{color:var(--accent)}a:hover{text-decoration:none}button,.button,a.button,input[type="submit"],input[type="reset"],input[type="button"],label[type="button"]{border:1px solid var(--accent);background-color:var(--accent);color:var(--accent-text);padding:.5rem .9rem;text-decoration:none;line-height:normal}.button[aria-disabled="true"],input:disabled,textarea:disabled,select:disabled,button[disabled]{cursor:not-allowed;background-color:var(--disabled);border-color:var(--disabled);color:var(--text-light)}input[type="range"]{padding:0}abbr[title]{cursor:help;text-decoration-line:underline;text-decoration-style:dotted}button:enabled:hover,.button:not([aria-disabled="true"]):hover,input[type="submit"]:enabled:hover,input[type="reset"]:enabled:hover,input[type="button"]:enabled:hover,label[type="button"]:hover{background-color:var(--accent-hover);border-color:var(--accent-hover);cursor:pointer}.button:focus-visible,button:focus-visible:where(:enabled),input:enabled:focus-visible:where([type="submit"],[type="reset"],[type="button"]){outline:2px solid var(--accent);outline-offset:1px}header>nav{font-size:1rem;line-height:2;padding:1rem 0 0 0}header>nav ul,header>nav ol{align-content:space-around;align-items:center;display:flex;flex-direction:row;flex-wrap:wrap;justify-content:center;list-style-type:none;margin:0;padding:0}header>nav ul li,header>nav ol li{display:inline-block}header>nav a,header>nav a:visited{margin:0 .5rem 1rem .5rem;border:1px solid var(--border);border-radius:var(--standard-border-radius);color:var(--text);display:inline-block;padding:.1rem 1rem;text-decoration:none}header>nav a:hover,header>nav a.current,header>nav a[aria-current="page"]{border-color:var(--accent);color:var(--accent);cursor:pointer}@media only screen and (max-width:720px){header>nav a{border:none;padding:0;text-decoration:underline;line-height:1}}article,fieldset,dialog{border:1px solid var(--border);padding:1rem;border-radius:var(--standard-border-radius);margin-bottom:1rem}article h2:first-child,section h2:first-child{margin-top:1rem}section{border-top:1px solid var(--border);border-bottom:1px solid var(--border);padding:2rem 1rem;margin:3rem 0}section+section,section:first-child{border-top:0;padding-top:0}section:last-child{border-bottom:0;padding-bottom:0}details{padding:.7rem 1rem}summary{cursor:pointer;font-weight:700;padding:.7rem 1rem;margin:-.7rem -1rem;word-break:break-all}details[open]>summary+*{margin-top:0}details[open]>summary{margin-bottom:.5rem}details[open]>:last-child{margin-bottom:0}textarea,select,input,button,.button{font-size:inherit;font-family:inherit;padding:.5rem;margin-bottom:.5rem;border-radius:var(--standard-border-radius);box-shadow:none;max-width:100%;display:inline-block}textarea,select,input{color:var(--text);background-color:var(--bg);border:1px solid var(--border)}label{display:block}textarea:not([cols]){width:100%}@media only screen and (max-width:720px){textarea,select,input{width:100%}}hr{border:none;height:1px;background:var(--border);margin:1rem auto}mark{padding:2px 5px;border-radius:var(--standard-border-radius);background-color:var(--marked);color:#000}mark a{color:#0d47a1}img,video{max-width:100%;height:auto;border-radius:var(--standard-border-radius)}dt{color:var(--text-light)}code,pre,pre span,kbd,samp{font-family:var(--mono-font);color:var(--code)}kbd{color:var(--preformatted);border:1px solid var(--preformatted);border-bottom:3px solid var(--preformatted);border-radius:var(--standard-border-radius);padding:.1rem .4rem}pre{padding:1rem 1.4rem;max-width:100%;overflow:auto;color:var(--preformatted)}pre code{color:var(--preformatted);background:none;margin:0;padding:0;}
        </style>
    <link href="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAACAAAAAgCAQAAADZc7J/AAACQklEQVRIx82VXYiMYRTHf2N2WR/5lmWbXbTyVZaISBSNsGJrbMqVJBc+C7nxUVtKbLlwQUpEKc2VIpESJVfsat0gS4sJmx3JfrDLjt++XKAdMztTMs/UzHme9/zP+f/POc8LqTyX3y4SNOWwEnoGAAkWEKG0jyuiV+IHQJNmLp9SPf81wDCiDM0doD/H+EgsV4AQm2jlCmNyBYjxnjuU9UWDIko8KWOs/+fxgkbmZitiIbM4yA2e8ZInxp5OvTVfkV0VCpjNGd79bNSv1Hp6nU9sYAIVnmYAGMUR3rrXzSvi7GOPHXeOz/6Wc5dm6/BXEStU+ZvOzznMNInAAF2+cJzx7JVQt6fXzDANQJSnWh2cFWhqsNOPndpxxTzFZWZw0kKmBFrZG8DqwGzWpUjd4yx0r5okt+R+yMiPKTanjcqakt6a3wEiMqsLmO83Kgzmkvks4jWPpLJZCVPcZkgQdyudWvUGifyaQYjtRksZZxVhrRLm8NDSRc2sR9ROtgWUFvNAK8kOn/mDQph1wXwnqVG6CPf4wFpnvuehVos5iOEcCMqbkFq4NxFDVNKgfZFxXKCd3U5ercU7bxbFVHEzuIEafCqUvg8mW/tyTli6GmnEdK1kPUe5L2CKNntiUqZODLPLxom7d9o+bHd1BT3ZZi7VDMzUiSG2qPlVU16mXC12QYdTWGcfLGdENrOwlDeqPyWYidGO1BLXTEYGxc3iSptvGRtVPsc7sVDWLaqdx6U6UaYF//W1ngYg71db3i/XvNZ3aV+LBcGjZmEAAAAASUVORK5CYII=" rel="icon" type="image/png">
    </head>
    <body>
        <h2>Untrack My Link</h2>

        <form id="getUrl">
            <input type="text" id="badurl" name="badurl" style="width: 100%;"><br />
            <button type="submit" id="untrack" >Untrack it</button>
            <button type="button" id="untrackopen" >Untrack & open</button><br />
        </form>
        
        <div id="suburl"></div>
        <div id="suburlraw" style="display:none;"></div>

        <div id="what">
            <h3>What is this?</h3>
            <p>It's a simple utility to try and get the real link embedded in another link that's been URL encoded and 
            festooned with a bunch of tracking variables. These are links that look like <mark>https://tracking.newslet.tr/url/https:%2F%2Fwww.example.com%2Fposts%2Fsome-cool-article%3trk_source=newslettr/417d2dd8-e2f7-47fa-b4da-ed8c54fba949/jKLHueeha37ahH35Khhwy6Lllq</mark>
            </p> 
            <p>After decoding and stripping, you'd get <mark>https://www.example.com/posts/some-cool-article</mark> which is presumably
            the <em>actual</em> page you want to visit.</p>
            
            <h3>What's in it?</h3>
            <p>Not much! This is a real quick and dirty attempt to solve this problem in about 10 lines of javascript. It only decodes the submitted 
            text and looks for substrings that appear to be proper URLs. That's it for code.</p>
            
            <p>The styles are a stripped down, customized <a href="https://simplecss.org">Simple.css</a>, a project I really like. It's minified, but comprehensible.</p>
            
            <p>I'm sure this can be improved a lot, and there's a few thoughts below. That said, the main goal is for it to be self-contained and so straightforward that
            anyone with even a little JS can understand the source in just a few seconds.</p>

            <h3>NB</h3>
            <p>Perhaps needless to say, but this won't work on tracking URLs that rely on a server redirect based on a unique id
            e.g. those of the form <mark>https://tracking.newslet.tr/?trid=1971722365764871763</mark> The only way to get the actual destination of that
            type of link is to actually follow it, which defeats the purpose of course.
            
            <h3>Todo?</h3>
            <ul>
                <li><strong>Let the page accept the input link as a parameter?</strong></li>
                <li><strong>Make it a bookmarklet?</strong></li>
                <li><strong>Make it a browser plugin?</strong> 
                    <ul><li>This was the initial plan... to allow me to right click a link and see the "untracked" version and then open it on click. The 
                    APIs for Firefox plugins fought me just enough that I decided to do this simple version, and it's been working well enough that I haven't been motivated to
                    make the better version.</li></ul>
                </li>
            </ul>
        </div>
        <footer>
            2024 - Kerry Benton - <a href="https://github.com/kbenton/untrackmylink">Github</a>
        </footer>
 		<script type="text/javascript">
            const form = document.getElementById("getUrl");

			function processUrl() {
				let url = document.getElementById("badurl").value;
				let durl = decodeURIComponent(url);
				let suburl = durl.slice(1);
				suburl = suburl.match(/https?:\/\/[^\s]+/)[0];
				suburl = suburl.match(/.+?(?=\?)/)[0];
				document.getElementById("suburl").innerHTML = "<a href=\"" + suburl + "\">" + suburl + "</a><br /><br />(<small>" + url + "<small>)";
				document.getElementById("badurl").value = "";

				document.getElementById("suburlraw").innerHTML = suburl;
			};
            
			form.addEventListener('submit', function(event) {
				event.preventDefault();
				processUrl();
			});

			document.getElementById('untrackopen').onclick = function(event) {
				event.preventDefault();
				processUrl();                              // replace these two lines with form.submit()?
				var finalurl = document.getElementById("suburlraw").innerHTML;
				window.open(finalurl).focus();	 
			};
			//todo?: add code to toggle visibility of the what div?
		</script>
	</body>
</html>
